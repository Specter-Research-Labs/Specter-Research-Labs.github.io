<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="color-scheme" content="light" />
        <title>Local CLI Harness (`LeniaCLI local`) | SPECTER Labs</title>
        <link rel="icon" href="../../../assets/logo-black.svg" type="image/svg+xml" />
        <link rel="icon" href="../../../assets/favicon.png" type="image/png" />
        <link rel="stylesheet" href="../../../style.css" />
        <link rel="stylesheet" href="../../../cabinet/cabinet.css" />
    </head>
    <body class="cabinet-page">
        <div class="doc-shell">
            <div class="doc-paper">
                <div class="doc-top">
                    <header class="doc-masthead">
                        <a class="doc-brand" href="../../../">
                            <img
                                src="../../../assets/logo-black.svg"
                                alt="SPECTER Labs logo"
                                class="logo"
                            />
                            <span class="doc-brand-name">SPECTER Labs</span>
                        </a>
                        <div class="doc-markings">
                            <span class="doc-marking">Technical Docs</span>
                                                    </div>
                    </header>
                    <div class="doc-rules" aria-hidden="true">
                        <div class="doc-rule strong"></div>
                        <div class="doc-rule"></div>
                    </div>
                </div>

                <main class="doc-layout">
                    <aside class="doc-aside">
                        <a class="doc-nav-back" href="../../../cabinet/">
                            &larr; Cabinet
                        </a>

                        <div class="doc-stamp">
                                                        <div class="doc-stamp-id">LS-003</div>
                                                        <div class="doc-stamp-title">Lenia Swarm</div>
                                                        <div class="doc-stamp-sub">LocalCLI</div>
                                                                                                                <div class="doc-stamp-field">
                                <strong>Source</strong>
                                <code>dossiers/lenia-swarm/docs/LocalCLI.md</code>
                            </div>
                                                                                    <div class="doc-stamp-field">
                                <strong>Built</strong>
                                2026-02-19T15:28:20Z
                            </div>
                                                    </div>

                                            </aside>

                    <article class="doc-content"><p>Local CLI Harness (<code>LeniaCLI local</code>)</p>
<p>Purpose</p>
<ul>
<li>Run a single-machine Flow-Lenia simulation from a pair of JSON configs (base + search) and write a self-contained artifact directory.</li>
<li>Optional: export grayscale truth frames (PNG) for quick visual inspection.</li>
</ul>
<p>Build (required for Metal) SwiftPM (<code>swift run/build</code>) does not compile Metal shaders for MLX; use Xcode:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> dossiers/lenia-swarm</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="ex">xcodebuild</span> build <span class="at">-scheme</span> LeniaCLI <span class="at">-destination</span> <span class="st">&#39;platform=OS X&#39;</span> <span class="at">-configuration</span> Release</span></code></pre></div>
<p>Quickstart</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> dossiers/lenia-swarm</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Minimal smoke (no frames)</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="ex">LeniaCLI</span> local <span class="dt">\</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">--config</span> configs/paper_base_1c_128.json <span class="dt">\</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">--search</span> configs/search_smoke.json <span class="dt">\</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">--output</span> /tmp/lenia-smoke</span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a><span class="co"># With frames (count=1 only)</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a><span class="ex">LeniaCLI</span> local <span class="dt">\</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">--config</span> configs/paper_base_1c_128.json <span class="dt">\</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a>  <span class="at">--search</span> configs/search_smoke.json <span class="dt">\</span></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">--output</span> /tmp/lenia-smoke <span class="dt">\</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">--frames</span> <span class="dt">\</span></span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">--frame-stride</span> 5</span></code></pre></div>
<p>Required Inputs</p>
<ul>
<li><code>--config</code>: Path to base config JSON (decoded into <code>LeniaBaseConfig</code>).</li>
<li><code>--search</code>: Path to search config JSON (decoded into <code>ParsedSearchConfig</code>).</li>
<li><code>--output</code>: Output root directory. The command creates a run directory <code>--output/&lt;run_id&gt;/</code>.</li>
</ul>
<p>Optional Overrides</p>
<ul>
<li><code>--seed</code>: Overrides <code>seed_start</code> from the search config for this run.</li>
<li><code>--count</code>: Overrides <code>count</code> from the search config.</li>
<li><code>--validate-only</code>: Validates configs and exits without running.</li>
</ul>
<p>Frame Export</p>
<ul>
<li><code>--frames</code>: Enable frame export to <code>&lt;run_dir&gt;/frames</code>.</li>
<li><code>--frames-dir &lt;path&gt;</code>: Override frames directory.
<ul>
<li>Absolute paths are used as-is.</li>
<li>Relative paths are resolved under <code>&lt;run_dir&gt;/</code>.</li>
</ul></li>
<li><code>--frame-stride &lt;n&gt;</code>: Steps between captured frames (<code>n &gt; 0</code>).</li>
<li><code>--include-warmup-frames</code>: If set, includes warmup steps in frame capture.</li>
<li><code>--sample-index</code>: Which batch sample to render when <code>batch_size &gt; 1</code>.</li>
</ul>
<p>Frame export invariants (enforced)</p>
<ul>
<li>Frame export requires <code>count=1</code>.</li>
<li>Frame export requires <code>sample_index=0</code> when <code>count=1</code>.</li>
</ul>
<p>Artifact Layout Within <code>--output/&lt;run_id&gt;/</code>:</p>
<ul>
<li><code>config.json</code>: Copy of the base config used for the run.</li>
<li><code>search.json</code>: Copy of the search config used for the run.</li>
<li><code>results.jsonl</code>: One JSON object per simulation result.</li>
<li><code>top.json</code>: Top-K results (only written if at least one result passes filters).</li>
<li><code>summary.json</code>: Run metadata (includes duration, counts, and frame settings).</li>
<li><code>frames/</code> (optional): <code>frame_000000.png</code>, <code>frame_000005.png</code>, â€¦</li>
</ul>
<p>Logs</p>
<ul>
<li>By default, logs/metrics are written under <code>SPECTER_LOG_ROOT/lenia-swarm/logs/&lt;run_id&gt;/</code> when <code>SPECTER_LOG_ROOT</code> is set.</li>
<li>Otherwise logs fall back to <code>&lt;output&gt;/logs/&lt;run_id&gt;/</code>.</li>
</ul>
<p>Determinism Smoke <code>scripts/deterministic-smoke.sh</code> runs the same fixed-seed local run twice and checks that:</p>
<ul>
<li><code>results.jsonl</code> matches byte-for-byte</li>
<li>the exported PNG frame set matches by checksum</li>
</ul>
<p>Run it from repo root:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">./dossiers/lenia-swarm/scripts/deterministic-smoke.sh</span></span></code></pre></div></article>
                </main>

                <footer class="doc-footer">
                    <div class="doc-footer-inner">
                        <div>Specter Labs</div>
                        <div>Lenia Swarm</div>
                    </div>
                </footer>
            </div>
        </div>
    </body>
</html>
